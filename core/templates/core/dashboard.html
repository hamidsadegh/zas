{% extends "core/base.html" %}

{% block title %}ZAS Dashboard{% endblock %}

{% block styles %}
.dashboard-hero {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 2rem;
}

main {
    max-width: none;
    width: 95vw;
    margin: 0 auto;
}

.hero-card {
    background: var(--surface);
    border-radius: 22px;
    padding: 2rem;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.hero-actions {
    display: flex;
    justify-content: flex-start;
}

.primary-btn {
    background: var(--primary);
    color: #fff;
    border-radius: 999px;
    padding: 0.65rem 1.4rem;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    box-shadow: var(--shadow);
}

.primary-btn:hover {
    color: #fff;
    background: var(--primary-dark);
}

.hero-meta {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
    color: var(--muted);
    font-size: 0.95rem;
}

.stat-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.2rem;
}

.stat-card {
    background: #f8faff;
    border-radius: 18px;
    padding: 1.5rem;
    border: 1px solid var(--border);
}

.stat-card h4 {
    margin: 0;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
}

.stat-card .value {
    font-size: 2rem;
    font-weight: 600;
    margin-top: 0.4rem;
}

.stat-card .delta {
    margin-top: 0.2rem;
    font-size: 0.9rem;
    color: var(--muted);
}

.section {
    margin-top: 2.5rem;
}

.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.2rem;
}

.section-header h3 {
    margin: 0;
}

.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 1.5rem;
}

.card {
    background: var(--surface);
    border-radius: 18px;
    padding: 1.5rem;
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
}

.card table {
    width: 100%;
    border-collapse: collapse;
}

.card table th {
    text-align: left;
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--muted);
    padding-bottom: 0.5rem;
}

.card table td {
    padding: 0.35rem 0;
    border-top: 1px solid var(--border);
}
.reachability-dot {
    width: 0.7rem;
    height: 0.7rem;
    border-radius: 50%;
    display: inline-block;
    border: 1px solid var(--border);
}
.reachability-dot.ok {
    background: #22c55e;
    border-color: #16a34a;
}
.reachability-dot.fail {
    background: #ef4444;
    border-color: #dc2626;
}
.reachability-dot.disabled {
    background: #e5e7eb;
    border-color: #d1d5db;
}

.tag {
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
    background: #eef2ff;
    color: var(--primary);
}

.link-btn {
    font-size: 0.9rem;
    font-weight: 600;
}

@media (max-width: 640px) {
    .section-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.6rem;
    }
}
{% endblock %}

{% block content %}
{% now "M d, H:i" as current_time %}
<section class="dashboard-hero">
    <div class="hero-card">
        <div>
            <p class="tag">Centralized Administration</p>
            <h1 style="margin: 0.5rem 0 0;">Welcome back to ZAS</h1>
            <p style="color: var(--muted); margin: 0.4rem 0 0;">
                Real-time visibility into your network inventory, health, and automation status.
            </p>
        </div>
        <div class="hero-meta">
            <span>Last refresh: {{ current_time }}</span>
            <span>Total devices tracked: {{ device_stats.total|default:0 }}</span>
        </div>
        <div class="hero-actions">
            <a class="primary-btn" href="{% url 'system_settings' %}">System Settings</a>
        </div>
    </div>

    <div class="stat-grid">
        <div class="stat-card">
            <h4>Active Devices</h4>
            <div class="value">{{ device_stats.active|default:0 }}</div>
            <div class="delta">Inactive: {{ device_stats.inactive|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h4>Maintenance</h4>
            <div class="value">{{ device_stats.maintenance|default:0 }}</div>
            <div class="delta">Unknown: {{ device_stats.unknown|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h4>Interfaces Up / Connected</h4>
            <div class="value">{{ interface_stats.up_connected|default:0 }}</div>
            <div class="delta">Not connected: {{ interface_stats.notconnected|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h4>Disabled Interfaces</h4>
            <div class="value">{{ interface_stats.disabled|default:0 }}</div>
            <div class="delta">Total: {{ interface_stats.total|default:0 }}</div>
        </div>
        <div class="stat-card">
            <h4>Err-Disabled Interfaces</h4>
            <div class="value">{{ interface_stats.err_disabled|default:0 }}</div>
            <a class="link-btn" href="{% url 'err_disabled_interfaces' %}">View interfaces</a>
        </div>
        <div class="stat-card">
            <h4>All Interfaces</h4>
            <div class="value">{{ interface_stats.total|default:0 }}</div>
            <a class="link-btn" href="{% url 'all_interfaces' %}">View interfaces</a>
        </div>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h3>Quick navigation</h3>
        <div>
            <a class="link-btn" href="{% url 'device_list' %}">Manage devices →</a>
        </div>
    </div>
    <div class="card-grid">
        <div class="card">
            <h4>Devices</h4>
            <p>Manage inventory, configurations, and lifecycle.</p>
            <a class="link-btn" href="{% url 'device_list' %}">View devices</a>
        </div>
        <div class="card">
            <h4>Organization (Sites & Areas & Racks)</h4>
            <p>Visualize geographic or logical distribution.</p>
            <a class="link-btn" href="{% url 'organization_home' %}">Browse areas</a>
        </div>
        <div class="card">
            <h4>Discovery</h4>
            <p>Review newly discovered devices and promote them into DCIM.</p>
            <a class="link-btn" href="{% url 'network:discovery_dashboard' %}">Open discovery</a>
        </div>
        <div class="card">
            <h4>System Settings</h4>
            <p>Configure TACACS+ and global authentication policies.</p>
            <a class="link-btn" href="{% url 'system_settings' %}">Open settings</a>
        </div>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h3>Latest activity</h3>
    </div>
    <div class="card-grid">
        <div class="card">
            <h4 style="margin-top: 0;">Recently added devices</h4>
            <table>
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Area</th>
                        <th>Vendor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for device in recent_devices %}
                    <tr>
                        <td><a href="{% url 'device_detail' device.pk %}">{{ device.name }}</a></td>
                        <td>{{ device.area|default:"—" }}</td>
                        <td>{{ device.device_type.vendor|default:"—" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No devices yet.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="card">
            <h4 style="margin-top: 0;">Recent health checks</h4>
            <table>
                <thead>
                    <tr>
                        <th>Device</th>
                        <th>Reachability</th>
                        <th>Last check</th>
                    </tr>
                </thead>
                <tbody>
                    {% for device in recent_checks %}
                    <tr>
                        <td><a href="{% url 'device_detail' device.pk %}">{{ device.name }}</a></td>
                        <td style="display:flex; gap:0.35rem; align-items:center;">
                            <span class="reachability-dot {% if device.runtime.reachable_ping %}ok{% else %}fail{% endif %}" title="Ping"></span>
                            <span class="reachability-dot {% if device.runtime.reachable_ssh %}ok{% else %}fail{% endif %}" title="SSH"></span>
                            <span class="reachability-dot {% if device.runtime.reachable_snmp %}ok{% else %}fail{% endif %}" title="SNMP"></span>
                            <span class="reachability-dot {% if device.runtime.reachable_netconf %}ok{% else %}fail{% endif %}" title="Netconf"></span>
                        </td>
                        <td>{{ device.runtime.last_check|date:"M d, H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="3">No recent checks recorded.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<section class="section">
    <div class="section-header">
        <h3>Top vendors</h3>
    </div>
    <div class="card-grid">
        {% for vendor in top_vendors %}
        <div class="card">
            <h4 style="margin-top: 0;">{{ vendor.name }}</h4>
            <p style="margin: 0.2rem 0 0;">Devices: {{ vendor.device_count }}</p>
        </div>
        {% empty %}
        <p>No vendor data available yet.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
