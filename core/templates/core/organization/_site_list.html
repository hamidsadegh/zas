<div class="section-title">
    <div>
        <h3>Sites</h3>
        <div class="muted">Navigate to a site to manage areas and racks.</div>
    </div>
    <span class="chip subtle">{{ sites|length }} total</span>
</div>
{% if site_form and site_form.errors %}
    <div class="notice error">
        {% for field, errors in site_form.errors.items %}
            {{ errors|join:", " }}
        {% endfor %}
    </div>
{% endif %}
<div class="site-list">
    {% for site in sites %}
    <div class="site-row {% if selected_site and site.id == selected_site.id %}active{% endif %}">
        <div class="site-meta">
            <button
                type="button"
                hx-get="{% url 'organization_home' %}?site={{ site.id }}"
                hx-target="#organization-page"
                hx-swap="outerHTML"
                hx-push-url="true"
            >
                {{ site.name }}
            </button>
            <div class="muted small-text">{{ site.description|default:"No description yet." }}</div>
        </div>
        <div class="site-actions">
            <button
                type="button"
                class="btn btn-ghost small"
                hx-get="{% url 'organization_site_edit_form' site.id %}"
                hx-target="closest .site-row"
                hx-swap="outerHTML"
            >Edit</button>
            <form
                method="post"
                hx-post="{% url 'organization_site_delete' site.id %}"
                hx-confirm="Delete site '{{ site.name }}'?"
                hx-target="#site-list"
                hx-swap="outerHTML"
            >
                {% csrf_token %}
                <button type="submit" class="btn btn-danger small">Delete</button>
            </form>
        </div>
    </div>
    {% empty %}
    <div class="notice">No sites yet. Create the first site below.</div>
    {% endfor %}
</div>

{% if organization %}
    <form
        class="stacked spacing-top"
        method="post"
        hx-post="{% url 'organization_site_create' %}"
        hx-target="#site-list"
        hx-swap="outerHTML"
    >
        {% csrf_token %}
        <label class="muted" for="id_site_name">Add Site</label>
        <input id="id_site_name" type="text" name="name" class="input" placeholder="Site name" required>
        <textarea name="description" class="textarea" placeholder="Description (optional)"></textarea>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Create Site</button>
        </div>
    </form>
{% else %}
    <div class="notice">Create an organization in admin before adding sites.</div>
{% endif %}
