{% extends "base.html" %}

{% block title %}Device {{ device.name }}{% endblock %}

{% block content %}
<div class="container mt-4">

  <!-- Top Row: Basic Info & Vendor / Platform / Role -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">Basic Information</div>
        <div class="card-body">
          <p><strong>Name:</strong> {{ device.name }}</p>
          <p><strong>Management IP:</strong> {{ device.management_ip }}</p>
          <p><strong>MAC Address:</strong> {{ device.mac_address|default:"-" }}</p>
          <p><strong>Serial Number:</strong> {{ device.serial_number|default:"-" }}</p>
          <p><strong>Inventory Number:</strong> {{ device.inventory_number|default:"-" }}</p>
          <p><strong>Status:</strong> {{ device.status|default:"unknown" }}</p>
          <p><strong>Uptime:</strong> {{ device.uptime|default:"-" }}</p>
          <p><strong>Area:</strong> {% if device.area %}{{ device.area }}{% else %}-{% endif %}</p>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-header bg-secondary text-white">Vendor / Platform / Role</div>
        <div class="card-body">
          <p><strong>Vendor:</strong> {% if device.vendor %}{{ device.vendor.name }}{% else %}-{% endif %}</p>
          <p><strong>Platform:</strong> {% if device.platform %}{{ device.platform.name }}{% else %}-{% endif %}</p>
          <p><strong>Device Type:</strong> {% if device.device_type %}{{ device.device_type.model }}{% else %}-{% endif %}</p>
          <p><strong>Role:</strong> {% if device.role %}{{ device.role.name }}{% else %}-{% endif %}</p>
          <p><strong>Image Version:</strong> {{ device.image_version|default:"-" }}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Device Configuration -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-info text-white">Configuration</div>
    <div class="card-body">
      <pre>{{ device.configuration|default:"No configuration available." }}</pre>
    </div>
  </div>

  <!-- Interfaces -->
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-success text-white">Interfaces</div>
    <div class="card-body">
      <form method="get" class="mb-3">
        <div class="input-group mb-2">
          <input type="text" name="search" class="form-control" placeholder="Search interfaces..." value="{{ search_query }}">
            <select name="paginate_by" class="form-select" style="max-width:100px;">
                <option value="10" {% if paginate_by|stringformat:"s" == "10" %}selected{% endif %}>10</option>
                <option value="25" {% if paginate_by|stringformat:"s" == "25" %}selected{% endif %}>25</option>
                <option value="50" {% if paginate_by|stringformat:"s" == "50" %}selected{% endif %}>50</option>
                <option value="100" {% if paginate_by|stringformat:"s" == "100" %}selected{% endif %}>100</option>
            </select>

          <button class="btn btn-primary" type="submit">Apply</button>
        </div>
      </form>

      {% if interfaces %}
      <table class="table table-striped table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th><a href="?sort=name{% if search_query %}&search={{ search_query }}{% endif %}">Name</a></th>
            <th><a href="?sort=description{% if search_query %}&search={{ search_query }}{% endif %}">Description</a></th>
            <th><a href="?sort=ip_address{% if search_query %}&search={{ search_query }}{% endif %}">IP Address</a></th>
            <th><a href="?sort=mac_address{% if search_query %}&search={{ search_query }}{% endif %}">MAC Address</a></th>
            <th><a href="?sort=status{% if search_query %}&search={{ search_query }}{% endif %}">Status</a></th>
            <th><a href="?sort=endpoint{% if search_query %}&search={{ search_query }}{% endif %}">Endpoint</a></th>
            <th><a href="?sort=speed{% if search_query %}&search={{ search_query }}{% endif %}">Speed (Mbps)</a></th>
          </tr>
        </thead>
        <tbody>
          {% for interface in interfaces %}
          <tr>
            <td>{{ interface.name }}</td>
            <td>{{ interface.description|default:"-" }}</td>
            <td>{{ interface.ip_address|default:"-" }}</td>
            <td>{{ interface.mac_address|default:"-" }}</td>
            <td>
              {% if interface.status == 'up' %}
                <span class="badge bg-success">{{ interface.status }}</span>
              {% elif interface.status == 'down' %}
                <span class="badge bg-secondary">{{ interface.status }}</span>
              {% elif interface.status == 'disabled' %}
                <span class="badge bg-warning text-dark">{{ interface.status }}</span>
              {% else %}
                <span class="badge bg-light text-dark">{{ interface.status }}</span>
              {% endif %}
            </td>
            <td>{{ interface.endpoint|default:"-" }}</td>
            <td>{{ interface.speed|default:"-" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Pagination controls -->
      <nav aria-label="Interface pagination">
        <ul class="pagination justify-content-center">
          {% if interfaces.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ interfaces.previous_page_number }}&search={{ search_query }}&paginate_by={{ paginate_by }}">Previous</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Previous</span></li>
          {% endif %}

          {% for num in interfaces.paginator.page_range %}
            {% if interfaces.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}&search={{ search_query }}&paginate_by={{ paginate_by }}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if interfaces.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ interfaces.next_page_number }}&search={{ search_query }}&paginate_by={{ paginate_by }}">Next</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">Next</span></li>
          {% endif %}
        </ul>
      </nav>
      {% else %}
        <p>No interfaces found.</p>
      {% endif %}
    </div>
  </div>

  <a href="{% url 'device_list' %}" class="btn btn-secondary mb-4">Back to Device List</a>
</div>
{% endblock %}
