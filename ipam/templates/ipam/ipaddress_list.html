{% extends "core/base.html" %}
{% block title %}IP Addresses{% endblock %}

{% block styles %}
{% include "dcim/_layout_styles.html" %}
main { width: 50%; max-width: 900px; margin: 0 auto; }
.card { max-width: 900px; margin: 0 auto; }
.ipam-filters {
    display:flex;
    align-items:center;
    gap:0.5rem;
    flex-wrap: wrap;
    width: 100%;
}
.ipam-filters select {
    flex: 1 1 160px;
    min-width: 140px;
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.ipam-filters input[type="text"] {
    flex: 2 1 260px;
    min-width: 200px;
}
.table-actions .btn-ghost { padding: 0.3rem 0.7rem; border-radius: 10px; font-size: 0.9rem; }
{% endblock %}

{% block content %}
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.75rem;">
        <div>
            <p class="tag">IPAM</p>
            <h1 style="margin:0;">IP Addresses</h1>
        </div>
        <div style="display:flex; gap:0.6rem; align-items:center;">
            <a href="{% url 'ipam:index' %}" class="btn back">Back</a>
            <a class="btn btn-primary" href="{% url 'ipam:ipaddress_add' %}">Assign IP</a>
        </div>
    </div>
    <form method="get" class="ipam-filters">
        <select name="prefix" onchange="this.form.submit()">
            <option value="">All prefixes</option>
            {% for pref in prefixes %}
                <option value="{{ pref.id }}" {% if request.GET.prefix == pref.id|stringformat:'s' %}selected{% endif %}>{{ pref.cidr }}</option>
            {% endfor %}
        </select>
        <select name="status" onchange="this.form.submit()">
            <option value="">Any status</option>
            {% for key,label in form.fields.status.choices %}
                <option value="{{ key }}" {% if request.GET.status == key %}selected{% endif %}>{{ label }}</option>
            {% endfor %}
        </select>
        <select name="device" onchange="this.form.submit()">
            <option value="">All devices</option>
            {% for dev in devices %}
                <option value="{{ dev.id }}" {% if request.GET.device == dev.id|stringformat:'s' %}selected{% endif %}>{{ dev.name }}</option>
            {% endfor %}
        </select>
        <select name="interface" onchange="this.form.submit()">
            <option value="">All interfaces</option>
            {% for iface in interfaces %}
                <option value="{{ iface.id }}" {% if request.GET.interface == iface.id|stringformat:'s' %}selected{% endif %}>{{ iface.device.name }} / {{ iface.name }}</option>
            {% endfor %}
        </select>
        <input class="filter-search-wide" type="text" name="search" value="{{ request.GET.search }}" placeholder="Search IP/hostname">
    </form>
    <div class="table-scroll">
    <table class="data-table">
        <thead>
            <tr>
                <th>Address</th>
                <th>Prefix</th>
                <th>Device</th>
                <th>Interface</th>
                <th>Status</th>
                <th>Hostname</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for ip in ip_addresses %}
            <tr>
                <td>{{ ip.address }}</td>
                <td>{{ ip.prefix.cidr }}</td>
                <td>{% if ip.interface %}{{ ip.interface.device.name }}{% else %}—{% endif %}</td>
                <td>{% if ip.interface %}{{ ip.interface.name }}{% else %}—{% endif %}</td>
                <td>{{ ip.get_status_display }}</td>
                <td>{{ ip.hostname|default:"—" }}</td>
                <td class="table-actions"><a class="btn btn-ghost small" href="{% url 'ipam:ipaddress_detail' ip.id %}">View</a></td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="muted">No IP addresses found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endblock %}
