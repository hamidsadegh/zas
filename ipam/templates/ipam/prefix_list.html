{% extends "core/base.html" %}
{% block title %}Prefixes{% endblock %}

{% block styles %}
main { max-width: 1200px; }
.card { background: var(--surface); border:1px solid var(--border); border-radius:16px; padding:1.25rem; box-shadow: var(--shadow); }
.table { width:100%; border-collapse: collapse; }
.table th { text-align:left; font-size:0.8rem; text-transform: uppercase; letter-spacing:0.08em; color: var(--muted); padding:0.5rem 0; border-bottom:1px solid var(--border); }
.table td { padding:0.55rem 0; border-bottom:1px solid var(--border); }
.filters { display:flex; gap:0.5rem; flex-wrap:wrap; margin-bottom:0.8rem; }
.filters select { border:1px solid var(--border); border-radius:10px; padding:0.45rem 0.7rem; }
.actions a { margin-right:0.5rem; }
.btn { border:none; border-radius:999px; padding:0.55rem 1.1rem; font-weight:700; cursor:pointer; background: var(--primary); color:#fff; box-shadow: var(--shadow); }
{% endblock %}

{% block content %}
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.75rem;">
        <div>
            <p class="tag">IPAM</p>
            <h1 style="margin:0;">Prefixes</h1>
        </div>
        <div style="display:flex; gap:0.6rem; align-items:center;">
            <a href="{% url 'ipam:index' %}" class="link-btn">← Back</a>
            <a class="btn" href="{% url 'ipam:prefix_add' %}">Add Prefix</a>
        </div>
    </div>
    <form method="get" class="filters">
        <select name="vrf" onchange="this.form.submit()">
            <option value="">All VRFs</option>
            {% for vrf in form.fields.vrf.queryset %}
                <option value="{{ vrf.id }}" {% if request.GET.vrf == vrf.id|stringformat:'s' %}selected{% endif %}>{{ vrf.name }}</option>
            {% endfor %}
        </select>
        <select name="site" onchange="this.form.submit()">
            <option value="">All Sites</option>
            {% for site in form.fields.site.queryset %}
                <option value="{{ site.id }}" {% if request.GET.site == site.id|stringformat:'s' %}selected{% endif %}>{{ site.name }}</option>
            {% endfor %}
        </select>
        <select name="length" onchange="this.form.submit()">
            <option value="">Any length</option>
            {% for ln in prefix_lengths %}
                <option value="{{ ln }}"
                    {% if request.GET.length == ln|stringformat:"s" %}selected{% endif %}>
                    /{{ ln }}
                </option>
            {% endfor %}
        </select>
    </form>
    <table class="table">
        <thead>
            <tr>
                <th>Prefix</th>
                <th>VRF</th>
                <th>Site</th>
                <th>Role</th>
                <th>IPs</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for prefix in prefixes %}
            <tr>
                <td><a href="{% url 'ipam:prefix_detail' prefix.id %}">{{ prefix.cidr }}</a></td>
                <td>{{ prefix.vrf|default:"—" }}</td>
                <td>{{ prefix.site|default:"—" }}</td>
                <td>{{ prefix.get_role_display }}</td>
                <td>{{ prefix.ip_count|default:0 }}</td>
                <td class="actions">
                    <a href="{% url 'ipam:prefix_edit' prefix.id %}">Edit</a>
                    <a href="{% url 'ipam:prefix_delete' prefix.id %}">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="muted">No prefixes found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
