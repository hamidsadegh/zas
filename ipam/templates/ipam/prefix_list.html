{% extends "core/base.html" %}
{% block title %}Prefixes{% endblock %}

{% block styles %}
{% include "dcim/_layout_styles.html" %}
main { width: 50%; max-width: 900px; margin: 0 auto; }
.card { max-width: 900px; margin: 0 auto; }
.ipam-filters {
    display:flex;
    align-items:center;
    gap:0.5rem;
    flex-wrap: wrap;
    margin-bottom:0.8rem;
    width: 100%;
}
.ipam-filters select {
    flex: 1 1 160px;
    min-width: 140px;
    max-width: 220px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
.table-actions .btn-ghost { padding: 0.3rem 0.7rem; border-radius: 10px; font-size: 0.9rem; }
{% endblock %}

{% block content %}
<div class="card">
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:0.75rem;">
        <div>
            <p class="tag">IPAM</p>
            <h1 style="margin:0;">Prefixes</h1>
        </div>
        <div style="display:flex; gap:0.6rem; align-items:center;">
            <a href="{% url 'ipam:index' %}" class="btn back">Back</a>
            <a class="btn btn-primary" href="{% url 'ipam:prefix_add' %}">Add Prefix</a>
        </div>
    </div>
    <form method="get" class="ipam-filters">
        <select name="vrf" onchange="this.form.submit()">
            <option value="">All VRFs</option>
            {% for vrf in form.fields.vrf.queryset %}
                <option value="{{ vrf.id }}" {% if request.GET.vrf == vrf.id|stringformat:'s' %}selected{% endif %}>{{ vrf.name }}</option>
            {% endfor %}
        </select>
        <select name="site" onchange="this.form.submit()">
            <option value="">All Sites</option>
            {% for site in form.fields.site.queryset %}
                <option value="{{ site.id }}" {% if request.GET.site == site.id|stringformat:'s' %}selected{% endif %}>{{ site.name }}</option>
            {% endfor %}
        </select>
        <select name="length" onchange="this.form.submit()">
            <option value="">Any length</option>
            {% for ln in prefix_lengths %}
                <option value="{{ ln }}"
                    {% if request.GET.length == ln|stringformat:"s" %}selected{% endif %}>
                    /{{ ln }}
                </option>
            {% endfor %}
        </select>
    </form>
    <div class="table-scroll">
    <table class="data-table">
        <thead>
            <tr>
                <th>Prefix</th>
                <th>VRF</th>
                <th>Site</th>
                <th>Role</th>
                <th>IPs</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for prefix in prefixes %}
            <tr>
                <td><a href="{% url 'ipam:prefix_detail' prefix.id %}">{{ prefix.cidr }}</a></td>
                <td>{{ prefix.vrf|default:"—" }}</td>
                <td>{{ prefix.site|default:"—" }}</td>
                <td>{{ prefix.get_role_display }}</td>
                <td>{{ prefix.ip_count|default:0 }}</td>
                <td class="table-actions">
                    <a class="btn btn-ghost small" href="{% url 'ipam:prefix_edit' prefix.id %}">Edit</a>
                    <a class="btn btn-ghost small btn-danger" href="{% url 'ipam:prefix_delete' prefix.id %}">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="6" class="muted">No prefixes found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>
{% endblock %}
